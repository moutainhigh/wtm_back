$(function(){datepicker();$(".referbtn").click(function(){headSearch();queryClassChange()});queryClassChange()});function queryClassChange(){$("#queryclass").change(function(){console.log($("*").is(".userScoreTitle"));$(".refercontbtn").attr("name","0");$(".refercontbtn").click(function(){$(".refercont").children().remove("li")})})}function headSearch(){$(".tcdPageCode").children().remove();var e=1;var j=20;var i=$("#usename").val();var k=$("#useId").val();var d=$("#usetel").val();var l=$("#wechatname").val();var f=get_unix_time($("#startime").val());var b=get_unix_time($("#endtime").val());if($("#startime").val()==""){f="1475193600"}if($("#endtime").val()==""){b=get_unix_time(getNowEndDate())}if(i==""){i=null}if(k==""){k=null}if(d==""){d=null}if(l==""){l=null}var g=new UserInforCondi(i,l,d,k,f,b,e,j);var a=JSON.stringify(g);userinforscoretitle();$(".refercont").remove();getMemberInformation(a);var h=$(".tcdPageCode").attr("name");if(h>j){var c=Math.ceil(h/j);$(".tcdPageCode").createPage({pageCount:c,current:e,backFn:function(m){console.log("当前页是第"+m+"页");g=new UserInforCondi(i,l,d,k,f,b,m,j);a=JSON.stringify(g);$(".refercont").remove();getMemberInformation(a)}})}}function getMemberInformation(requestObj){$.ajax({type:"post",async:false,dataType:"json",contentType:"application/json",url:"/backward/getMemberInformation",data:requestObj,success:function(params){var json=eval(params);if(json.data!=null&&json.errorCode==0){if(json.data.total==0){$(".tcdPageCode").attr("name",json.data.total);alert("没有符合查询条件的对象")}else{$(".tcdPageCode").attr("name",json.data.total);json.data.list.forEach(function(e){userinforscorecont(e)})}}else{if(json.errorCode==4){alert(json.message)}}},error:function(data){alert("加载页面失败，请重新加载1")}})}function confirmUserInforSearch(f){$(f.parentNode).siblings().children(".refercontbtn").attr("name","0");var c=f.getAttribute("name");if(c==0){var e=$("#queryclass").get(0).selectedIndex;console.log(e);var b=f.parentNode.childNodes[0].innerHTML;if(e!=0){if($(f.parentNode).siblings().children().is("li")){$(f.parentNode).siblings().children().remove("li")}var a=1;var d=10;GetPageInfor(b,e,a,d,f);var g=$(".PageCode").attr("name")}}else{f.setAttribute("name","0");$(f.parentNode).children().remove("li")}}function GetPageInfor(memberId,flag,pageIndex,pageSize,object){$.ajax({type:"post",url:"/backward/getMemberInformationDetail",data:{memberId:memberId,flag:flag,pageIndex:pageIndex,pageSize:pageSize},success:function(params){var json=eval(params);if(json.errorCode==0){if(flag==1){userScoreTitle(memberId);userScoreCont(memberId,json.data)}else{if(flag==2){userFlowTitle(memberId);if(json.data.total>pageSize){CreatePage(memberId,flag,pageIndex,pageSize,object,json.data.total)}else{$(".PageCodeLi").css("display","none")}if(json.data.total==0){userFlowContent(memberId,"0")}json.data.list.forEach(function(e){userFlowContent(memberId,e)})}else{userContTitle(memberId);if(json.data.total>pageSize){CreatePage(memberId,flag,pageIndex,pageSize,object,json.data.total)}else{$(".PageCodeLi").css("display","none")}if(flag==4){if(json.data.total==0){oficialtitle(memberId,"0")}json.data.list.forEach(function(e){oficialtitle(memberId,e)});$(".PageCodeList").css("display","none")}else{if(json.data.total==0){userContContent(memberId,"0")}json.data.list.forEach(function(e){userContContent(memberId,e)})}}}object.setAttribute("name","1")}else{if(json.errorCode==4){alert(json.message);$("#queryclass").get(0).options[0].selected=true}}},error:function(data){alert("加载页面失败，请重新加载");$("#queryclass").get(0).options[0].selected=true}})}function getOfficialDetail(d){var c=1;var g=10;var a=$(d).children().eq(0).text();var i=$(d).children().eq(2).text();var e=d.getAttribute("name");$(d.parentNode).siblings().children().remove("li");$(d.parentNode).siblings().children(".officialcount").attr("name","0");var h=$(d).children(":first").text();var f="00";if(e==0){oficialdetailtitle(i);officialinforrequest(a,c,g,d);var b=$(".readOreye").attr("name");if(b>g){CreatePage(h,f,c,g,d,b)}else{$(".PageCodeLi").css("display","none")}$(".readOreye").change(function(){$(".PageCode").children().remove();$(".oficialcontbody").remove();officialinforrequest(a,c,g,d);var j=$(".readOreye").attr("name");console.log(j);if(j>g){CreatePage(h,f,c,g,d,j)}else{$(".PageCodeLi").css("display","none")}});d.setAttribute("name","1")}else{d.setAttribute("name","0");$(d.parentNode).children().remove("li")}}function officialinforrequest(id,pageIndex,pageSize,object,oficialtotal){var readOreye=$(".readOreye").get(0).selectedIndex;var originId=$(object).children().eq(2).text();$.ajax({type:"post",url:"/pc/admin/official/getTaskPoolDto",async:false,timeout:180000,data:{officialAccountId:id,type:readOreye,pageIndex:pageIndex,pageSize:pageSize},success:function(params){var json=eval(params);if(json.errorCode==0){$(".readOreye").attr("name",json.data.total);if(json.data.total==0){oficialdetailcont(originId,"0")}json.data.list.forEach(function(e){oficialdetailcont(originId,e,readOreye)})}else{if(json.errorCode==4){alert(json.message)}}},error:function(data){alert("页面加载错误，请重试")}})}function userinforscoretitle(){$(".referlist").empty();var h=11;var d=6;var g=[];var e=[];var f=new Array();f[0]=["refertitle"];f[1]=["col-xs-1","用户Id"];f[2]=["col-xs-1","用户名"];f[3]=["col-xs-1","微信昵称"];f[4]=["col-xs-1","电话"];f[5]=["col-xs-1","性别"];f[6]=["col-xs-1","地址"];f[7]=["col-xs-1","邀请码"];f[8]=["col-xs-2","注册时间"];f[9]=["col-xs-1","来源"];f[10]=["col-xs-1","是否禁用"];f[11]=["col-xs-1"];var c=new Array();c[0]=["查询内容"];c[1]=["米币总数"];c[2]=["米币流水"];c[3]=["历史任务记录"];c[4]=["公众号信息"];c[5]=["邀请记录"];var b=createElementList(g,h,f,"0");var a=createElementSelect(e,d,c);a.setAttribute("id","queryclass");g[10].appendChild(a);document.getElementsByTagName("ul")[1].appendChild(b)}function userinforscorecont(f){var h=11;var g=[];var e=new Array();e[0]=["refercont","",f.memberId];e[1]=["col-xs-1",f.memberId];e[2]=["col-xs-1",f.memberName];if(f.nickName==null||f.nickName==""){f.nickName="---"}e[3]=["col-xs-1",f.nickName];e[4]=["col-xs-1",f.telephone];if(f.sex==0){f.sex="保密"}else{if(f.sex==1){f.sex="男"}else{if(f.sex==2){f.sex="女"}}}e[5]=["col-xs-1",f.sex];if(f.address==null||f.address==""){f.address="---"}e[6]=["col-xs-1",f.address];e[7]=["col-xs-1",f.inviteCode];if(f.createTime==null||f.createTime==""){f.createTime=="---"}e[8]=["col-xs-2",getLocalTime(f.createTime)];e[9]=["col-xs-1",f.source];e[10]=["col-xs-1"];e[11]=["col-xs-1 refercontbtn","","0"];var b=createElementList(g,h,e,"0");var d=document.createElement("label");var c=document.createElement("input");c.className="switchOn";c.setAttribute("type","checkbox");c.setAttribute("data-on-color","primary");c.setAttribute("data-off-color","warning");c.setAttribute("data-size","small");c.setAttribute("data-on-text","开启");c.setAttribute("data-off-text","禁用");c.setAttribute("id",f.memberId);var a=document.createElement("input");a.setAttribute("type","button");a.setAttribute("value","查询");g[10].setAttribute("onClick","javaScript:confirmUserInforSearch(this)");g[2].setAttribute("title",f.nickName);g[5].setAttribute("title",f.address);g[9].appendChild(d);d.appendChild(c);g[10].appendChild(a);document.getElementsByTagName("ul")[1].appendChild(b);if(f.isForbidden==0){$("#"+f.memberId+"").bootstrapSwitch("state",true)}else{$("#"+f.memberId+"").bootstrapSwitch("state",false)}}function userScoreTitle(b){var e=6;var d=[];var c=new Array();c[0]=["referusertitle col-xs-12"];c[1]=["col-xs-1","米币总数"];c[2]=["col-xs-1","可用米币数"];c[3]=["col-xs-2","当前充值米币数"];c[4]=["col-xs-2","充值米币总数"];c[5]=["col-xs-3","即将可用米币数（关注）"];c[6]=["col-xs-3","即将可用米币数（邀请）"];var a=createElementList(d,e,c,"0");document.getElementsByName(b)[0].appendChild(a)}function userScoreCont(b,d){var f=6;var e=[];var c=new Array();if(d==null){d.totalScore=d.avaliableScore=d.currentChargeScore=d.totalChargeScore=d.futureAvaliableFollowScore=d.futureAvaliableInvitedScore=0}if(d.futureAvaliableFollowScore==null||d.futureAvaliableFollowScore==""){d.futureAvaliableFollowScore=0}c[0]=["referusercont col-xs-12"];c[1]=["col-xs-1",d.totalScore];c[2]=["col-xs-1",d.avaliableScore];c[3]=["col-xs-2",d.currentChargeScore];c[4]=["col-xs-2",d.totalChargeScore];c[5]=["col-xs-3",d.futureAvaliableFollowScore];c[6]=["col-xs-3",d.futureAvaliableInvitedScore];var a=createElementList(e,f,c,"0");document.getElementsByName(b)[0].appendChild(a)}function userFlowTitle(c){var f=7;var e=[];var d=new Array();d[0]=["referusertitle col-xs-12"];d[1]=["col-xs-2","流动类型"];d[2]=["col-xs-2","流动详情"];d[3]=["col-xs-2","创建时间"];d[4]=["col-xs-2","流动前"];d[5]=["col-xs-2","流动后"];d[6]=["col-xs-1","流动米币"];d[7]=["col-xs-1","流动状态"];var b=createPageElement();var a=createElementList(e,f,d,"0");document.getElementsByName(c)[0].appendChild(a);document.getElementsByName(c)[0].appendChild(b)}function userFlowContent(c,e){var b=document.getElementsByClassName("PageCodeLi");var g=7;var f=[];var d=new Array();d[0]=["referusercont col-xs-12"];if(e=="0"){d[1]=["col-xs-2","---"];d[2]=["col-xs-2","---"];d[3]=["col-xs-2","---"];d[4]=["col-xs-2","---"];d[5]=["col-xs-2","---"];d[6]=["col-xs-1","---"];d[7]=["col-xs-1","---"]}else{if(e.isFinished==0){e.isFinished="未完成"}else{e.isFinished="已完成"}d[1]=["col-xs-2",e.typeName];d[2]=["col-xs-2",e.typeDesc];d[3]=["col-xs-2",getLocalTime(e.createTime)];d[4]=["col-xs-2",e.memberScoreBefore];d[5]=["col-xs-2",e.memberScoreAfter];d[6]=["col-xs-1",e.flowScore];d[7]=["col-xs-1",e.isFinished]}var a=createElementList(f,g,d,"0");f[1].setAttribute("title",e.typeDesc);document.getElementsByName(c)[0].insertBefore(a,b[0])}function userContTitle(c){var e=$("#queryclass").get(0).selectedIndex;var g=4;var f=[];var d=new Array();d[0]=["referusertitle col-xs-12"];if(e==3){d[1]=["col-xs-3","任务类型"];d[2]=["col-xs-4","任务详情"];d[3]=["col-xs-2","任务米币"];d[4]=["col-xs-3","任务时间"]}else{if(e==4){d[1]=["col-xs-3","公众号Id"];d[2]=["col-xs-4","公众号名称"];d[3]=["col-xs-2","原始Id"];d[4]=["col-xs-3","创建时间"]}else{if(e==5){d[1]=["col-xs-3","用户名"];d[2]=["col-xs-4","被邀请人"];d[3]=["col-xs-2","是否已得奖励"];d[4]=["col-xs-3","邀请时间"]}}}var a=createElementList(f,g,d,"0");var b=createPageElement();document.getElementsByName(c)[0].appendChild(a);document.getElementsByName(c)[0].appendChild(b)}function userContContent(b,e){var j=document.getElementsByClassName("PageCodeLi");var g=$("#queryclass").get(0).selectedIndex;var d=4;var a=[];var c=new Array();c[0]=["referusercont col-xs-12"];for(var f=1;f<5;f++){c[f]=new Array()}c[1][0]="col-xs-3";c[2][0]="col-xs-4";c[3][0]="col-xs-2";c[4][0]="col-xs-3";if(e=="0"){for(var f=1;f<5;f++){c[f][1]="---"}}else{switch(g){case 3:c[1][1]=e.taskName;c[2][1]=e.taskDesc;c[3][1]=e.pointCount;c[4][1]=getLocalTime(e.createTime);break;case 4:c[1][1]=e.memberId;c[2][1]=e.userName;c[3][1]=e.originId;c[4][1]=getLocalTime(e.createTime);break;case 5:c[1][1]=e.memberId;c[2][1]=e.invitedName;if(e.isAccessForInvitor==0){c[3]=["col-xs-2","否"]}else{c[3]=["col-xs-2","是"]}c[4][1]=getLocalTime(e.createTime)}}var h=createElementList(a,d,c,"0");if(g==3){a[1].setAttribute("title",e.taskDesc)}document.getElementsByName(b)[0].insertBefore(h,j[0])}function oficialtitle(c,e){var b=document.getElementsByClassName("PageCodeLi");var g=5;var f=[];var d=new Array();d[0]=["officialcont col-xs-12","",e.originId];d[1]=["col-xs-12 officialcount","","0"];if(e=="0"){d[2]=["col-xs-3","---"];d[3]=["col-xs-4","---"];d[4]=["col-xs-2","---"];d[5]=["col-xs-3","---"]}else{d[2]=["col-xs-3",e.id];d[3]=["col-xs-4",e.userName];d[4]=["col-xs-2",e.originId];d[5]=["col-xs-3",getLocalTime(e.createTime)]}var a=createElementList(f,g,d,"1");f[0].setAttribute("onClick","javaScirpt:getOfficialDetail(this)");document.getElementsByName(c)[0].insertBefore(a,b[0])}function oficialdetailtitle(b){var d=8;var i=2;var a=[];var e=[];var c=new Array();c[0]=["oficialconttitle col-xs-12"];c[1]=["col-xs-2","任务名称"];c[2]=["col-xs-2","任务情况"];c[3]=["col-xs-1","单个任务奖励"];c[4]=["col-xs-1","所需数量"];c[5]=["col-xs-2","发布时间"];c[6]=["col-xs-2","剩余时间"];c[7]=["col-xs-1","剩余数量"];c[8]=["col-xs-1"];var f=new Array();f[0]=["关注"];f[1]=["阅读"];var j=createElementList(a,d,c,"0");var g=createElementSelect(e,i,f);g.className="readOreye";a[7].appendChild(g);var h=createPageElement();document.getElementsByName(b)[0].appendChild(j);document.getElementsByName(b)[0].appendChild(h)}function oficialdetailcont(b,f,g){var j=document.getElementsByClassName("PageCodeLi");var d=7;var a=[];var c=new Array();c[0]=["oficialcontbody col-xs-12"];if(f=="0"){c[1]=["col-xs-2","---"];c[2]=["col-xs-2","---"];c[3]=["col-xs-1","---"];c[4]=["col-xs-1","---"];c[5]=["col-xs-2","---"];c[6]=["col-xs-2","---"];c[7]=["col-xs-1","---"]}else{if(g==0){c[1]=["col-xs-2","关注公众号"]}else{c[1]=["col-xs-2",f.articleTitle]}c[2]=["col-xs-2"];c[3]=["col-xs-1",f.singleScore];c[4]=["col-xs-1",f.needNumber];c[5]=["col-xs-2",getLocalTime(f.createTime)];c[6]=["col-xs-2",f.remainDays];c[7]=["col-xs-1",f.remainNumber]}var i=createElementList(a,d,c,"0");var h=document.createElement("label");var e=document.createElement("input");e.className="switchOn";e.setAttribute("type","checkbox");e.setAttribute("data-on-color","primary");e.setAttribute("data-off-color","warning");e.setAttribute("data-size","small");e.setAttribute("data-on-text","已上线");e.setAttribute("data-off-text","已下线");e.setAttribute("name",f.taskId);if(f!="0"){a[1].appendChild(h);h.appendChild(e);a[0].setAttribute("title",f.articleTitle)}document.getElementsByName(b)[0].insertBefore(i,j[0]);if(f.isPublishNow==0){$("input[name="+f.taskId+"]").bootstrapSwitch("state",false)}else{$("input[name="+f.taskId+"]").bootstrapSwitch("state",true)}}function createElementList(f,d,b,e){var a=document.createElement("li");a.className=b[0][0];if(b[0][2]!=null&&b[0][2]!=undefined){a.setAttribute("name",b[0][2])}for(var c=0;c<d;c++){f[c]=document.createElement("div");f[c].className=b[c+1][0];if(b[c+1][1]==null||b[c+1][1]==undefined){f[c].innerHTML=""}else{f[c].innerHTML=b[c+1][1]}if(b[c+1][2]!=null&&b[c+1][2]!=undefined){f[c].setAttribute("name",b[c+1][2])}if(e==1){a.appendChild(f[0]);if(c>0){f[0].appendChild(f[c])}}else{a.appendChild(f[c])}}return a}function createPageElement(){var a=document.createElement("li");a.className="PageCodeLi col-xs-12";var b=document.createElement("div");b.className="PageCode";a.appendChild(b);return a}function createElementSelect(d,e,b){var a=document.createElement("select");for(var c=0;c<e;c++){d[c]=document.createElement("option");d[c].innerHTML=b[c];a.appendChild(d[c])}return a}function CreatePage(b,d,a,c,f,g){var e=Math.ceil(g/c);$(".PageCode").createPage({pageCount:e,current:a,backFn:function(h){if(d=="00"){$(f.parentNode).children(".oficialcontbody").remove();var i=$(f).children().eq(0).text();officialinforrequest(i,h,c,f,b)}else{$(f.parentNode).children().remove("li");GetPageInfor(b,d,h,c,f)}}})}$.fn.serializeObject=function(){var c={};var b=this.serializeArray();$.each(b,function(){if(c[this.name]){if(!c[this.name].push){c[this.name]=[c[this.name]]}c[this.name].push(this.value||"")}else{c[this.name]=this.value||""}});return c};function UserInforCondi(f,g,d,b,e,h,a,c){this.memberName=f;this.nickName=g;this.telephone=d;this.memberId=b;this.registerStartTime=e;this.registerEndTime=h;this.pageIndex=a;this.pageSize=c}function datepicker(){$(".form_datetime").datetimepicker({weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,showMeridian:1});$(".form_date").datetimepicker({language:"fr",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0});$(".form_time").datetimepicker({language:"fr",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:1,minView:0,maxView:1,forceParse:0});$("#fixstarttime").attr("data-date",getNowStartDate());$("#fixendtime").attr("data-date",getNowEndDate())}function getNowStartDate(){function j(d){return d<10?"0"+d:d}var e=new Date();var i=e.getFullYear();var a=e.getMonth()+1;var g=e.getDate();var c=e.getHours();var f=e.getMinutes();var b=e.getSeconds();return j((a-1)>0?i:i-1)+"-"+j((a-1)>0?a-1:12)+"-"+j(g)+"T"+j(c)+":"+j(f)+":"+j(b)+"Z"}function getNowEndDate(){function j(d){return d<10?"0"+d:d}var e=new Date();var i=e.getFullYear();var a=e.getMonth()+1;var g=e.getDate();var c=e.getHours();var f=e.getMinutes();var b=e.getSeconds();return j(i)+"-"+j(a)+"-"+j(g)+" "+j(c)+":"+j(f)}function get_unix_time(a){return new Date(a.replace(/-/g,"/")).getTime().toString().substr(0,10)}function getLocalTime(a){return new Date(+new Date(parseInt(a)*1000)+8*3600*1000).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"")};